/*! For license information please see play.bundle.js.LICENSE.txt */
(()=>{var e,t={608:(e,t,o)=>{"use strict";var s=o(260);class i extends s.Game{constructor(e,t,o){console.log("Creating game"),console.log("Socket id: "+t),console.log("Id to connect: "+o),super(e),this.socketId=t,this.idToConnect=o}}var n=Phaser.Physics.Arcade.Sprite;class l extends n{constructor(e,t,o,s){super(e,t,o,"player"),e.add.existing(this),e.physics.add.existing(this),this.id=s,this.scene=e}getGameMaster(){return this.scene.gameMaster}sync(e){this.setPosition(e.position.x,e.position.y),this.setVelocity(e.velocity.x,e.velocity.y),this.setRotation(e.rotation)}update(e){this.updateLeft(e),this.updateRight(e),this.updateUp(e),this.updateDown(e),this.updateStop(e)}moveUp(){this.setVelocityY(-30)}moveDown(){this.setVelocityY(30)}moveLeft(){this.setVelocityX(-30)}moveRight(){this.setVelocityX(30)}getState(){return{id:this.id,position:{x:this.x,y:this.y},velocity:{x:this.body.velocity.x,y:this.body.velocity.y},rotation:this.rotation}}updateStop(e){var t;e.up.isDown||e.down.isDown||e.left.isDown||e.right.isDown||0===this.body.velocity.x&&0===this.body.velocity.y||(null===(t=this.getGameMaster())||void 0===t||t.stop(this.id),this.stopMovement())}updateUp(e){var t;e.up.isDown&&(null===(t=this.getGameMaster())||void 0===t||t.move(this.id,"up"),this.moveUp())}updateDown(e){var t;e.down.isDown&&(null===(t=this.getGameMaster())||void 0===t||t.move(this.id,"down"),this.moveDown())}updateLeft(e){var t;e.left.isDown&&(null===(t=this.getGameMaster())||void 0===t||t.move(this.id,"left"),this.moveLeft())}updateRight(e){var t;e.right.isDown&&(null===(t=this.getGameMaster())||void 0===t||t.move(this.id,"right"),this.moveRight())}shootInWorld(e,t,o){var s;const i=Phaser.Math.Angle.Between(this.x,this.y,e,t);null===(s=this.getGameMaster())||void 0===s||s.shoot(this.id,e,t),o.spawnBullet(this.x,this.y,i)}stopMovement(){this.setVelocity(0,0)}}var r=Phaser.Physics.Arcade.Sprite;class a extends r{fire(e,t,o){console.log(e,t,o),this.setActive(!0),this.setVisible(!0),this.setPosition(e,t),this.setRotation(o),this.setVelocityX(200*Math.cos(o)),this.setVelocityY(200*Math.sin(o)),this.scene.time.addEvent({delay:1e3,callback:()=>{this.setActive(!1),this.setVisible(!1)}})}}class d extends Phaser.Physics.Arcade.Group{constructor(e){super(e.physics.world,e),this.createMultiple({frameQuantity:30,key:"bullet",active:!1,visible:!1,classType:a})}shootBullet(e,t,o){const s=this.getFirstDead(!1);s&&s.fire(e,t,o)}getState(){return{}}}class h{constructor(e,t){this.players=e,this.bulletsGroup=new d(t)}updatePlayerPosition(e,t){var o;null===(o=this.players.find((t=>t.id==e)))||void 0===o||o.update(t)}update(){}sync(e){e.players.length!=this.players.length&&e.players.forEach((e=>{const t=this.players[0].scene;null==this.players.find((t=>t.id==e.id))&&this.players.push(new l(t,e.position.x,e.position.y,e.id))})),this.players.forEach((t=>{const o=e.players.find((e=>e.id===t.id));o&&t.sync(o)}))}getState(){return{players:this.players.map((e=>e.getState())),bullets:this.bulletsGroup.getState()}}stop(e){var t;null===(t=this.players.find((t=>t.id==e)))||void 0===t||t.stopMovement()}shoot(e,t,o){var s;null===(s=this.players.find((t=>t.id==e)))||void 0===s||s.shootInWorld(t,o,this)}spawnBullet(e,t,o){this.bulletsGroup.shootBullet(e,t,o)}movePlayerUp(e){var t;null===(t=this.players.find((t=>t.id==e)))||void 0===t||t.moveUp()}movePlayerDown(e){var t;null===(t=this.players.find((t=>t.id==e)))||void 0===t||t.moveDown()}movePlayerLeft(e){var t;null===(t=this.players.find((t=>t.id==e)))||void 0===t||t.moveLeft()}movePlayerRight(e){var t;null===(t=this.players.find((t=>t.id==e)))||void 0===t||t.moveRight()}}var c=o(983);class p{constructor(e,t,o){this.scene=e,this.guest_sockets=o?void 0:[],this.peer=this.createPeer(t),o?this.connectTo(o):this.waitForConnection(),void 0===o&&setInterval((()=>{var e;null===(e=this.guest_sockets)||void 0===e||e.forEach((e=>{null==e||e.send({type:"sync",time:Date.now(),state:this.scene.getState()})}),500)}))}createPeer(e){return e?new c.ZP(e):new c.ZP}connectTo(e){this.peer.on("open",(()=>{var t;console.log("Connecting to id: "+e),this.socket=this.peer.connect(e),this.scene.world.players[0].id=this.peer.id,this.scene.game.playerId=this.peer.id,null===(t=this.socket)||void 0===t||t.on("open",(()=>{var t;console.log("Connection established with id: "+e),null===(t=this.socket)||void 0===t||t.send("Hello from "+this.peer.id),console.log("Socket? "+this.socket),this.socket&&this.socket.on("data",(e=>{console.log("Data received"),console.log(e),this.handleMessage(e)}))}))}))}handleMessage(e){if("move"==e.type)switch(console.log("Move message received"),e.direction){case"up":this.scene.movePlayerUp(e.playerId);break;case"down":this.scene.movePlayerDown(e.playerId);break;case"left":this.scene.movePlayerLeft(e.playerId);break;case"right":this.scene.movePlayerRight(e.playerId)}else"shoot"==e.type?(console.log("Shoot message received"),this.scene.shoot(e.playerId,e.x,e.y)):"stop"==e.type?(console.log("Stop message received"),this.scene.stop(e.playerId)):"sync"==e.type&&(console.log("Sync message received"),this.scene.sync(e.state))}waitForConnection(){return e=this,t=void 0,s=function*(){console.log("Waiting for connection (HostId: "+this.peer.id+")"),this.peer.on("open",(e=>{this.scene.world.players[0].id=e,this.scene.game.playerId=e,function(e){const t=`${window.location.href.split("play")[0]}play?id=${e}`,o=document.getElementById("joinLink");o instanceof HTMLAnchorElement&&(o.href=t);const s=document.getElementById("joinText");s.innerText=`Join with URL: ${t}`,o.onclick=e=>{e.preventDefault(),navigator.clipboard.writeText(t),s.innerText="Copied to Clipboard!",setTimeout((()=>{s.innerText=`Join with URL: ${t}`}),1e3)}}(e)})),this.peer.on("connection",(e=>{var t;console.log("Opened connection with id: "+e.peer),this.scene.world.players.push(new l(this.scene,100,100,e.peer));const o=e;null==o||o.on("open",(()=>{null==o||o.on("data",(e=>{console.log("Data received"),console.log(e),this.handleMessage(e)}))})),null===(t=this.guest_sockets)||void 0===t||t.push(o)}))},new((o=void 0)||(o=Promise))((function(i,n){function l(e){try{a(s.next(e))}catch(e){n(e)}}function r(e){try{a(s.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,r)}a((s=s.apply(e,t||[])).next())}));var e,t,o,s}move(e,t){var o;null===(o=this.socket)||void 0===o||o.send({type:"move",playerId:e,direction:t})}shoot(e,t,o){var s;console.log("Sending shoot message"),null===(s=this.socket)||void 0===s||s.send({type:"shoot",playerId:e,x:t,y:o})}stop(e){var t;null===(t=this.socket)||void 0===t||t.send({type:"stop",playerId:e})}}class u extends Phaser.Scene{constructor(){super({key:"MainScene"})}shoot(e,t,o){var s,i,n,l,r,a,d,h;const c=Phaser.Math.Angle.Between(null!==(i=null===(s=this.world.players.find((t=>t.id==e)))||void 0===s?void 0:s.x)&&void 0!==i?i:0,null!==(l=null===(n=this.world.players.find((t=>t.id==e)))||void 0===n?void 0:n.y)&&void 0!==l?l:0,t,o);this.world.spawnBullet(null!==(a=null===(r=this.world.players.find((t=>t.id==e)))||void 0===r?void 0:r.x)&&void 0!==a?a:0,null!==(h=null===(d=this.world.players.find((t=>t.id==e)))||void 0===d?void 0:d.y)&&void 0!==h?h:0,c)}stop(e){this.world.stop(e)}create(){const e=new l(this,100,100,"_me");this.world=new h([e],this),this.gameMaster=new p(this,this.game.socketId,this.game.idToConnect),this.controlKeys=this.input.keyboard.createCursorKeys(),this.input.on("pointerdown",(e=>{var t;this.world.shoot(null!==(t=this.game.playerId)&&void 0!==t?t:"_me",e.x,e.y)}))}getState(){return this.world.getState()}sync(e){this.world.sync(e)}update(){var e;this.world.update(),this.world.updatePlayerPosition(null!==(e=this.game.playerId)&&void 0!==e?e:"_me",this.controlKeys)}preload(){this.load.image("player","assets/bunny.png"),this.load.image("bullet","assets/bullet.png")}movePlayerUp(e){this.world.movePlayerUp(e)}movePlayerDown(e){this.world.movePlayerDown(e)}movePlayerLeft(e){this.world.movePlayerLeft(e)}movePlayerRight(e){this.world.movePlayerRight(e)}}const v={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:300,height:200},scene:[u],physics:{default:"arcade",arcade:{debug:!1}}},y={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:300,height:200},scene:[u],physics:{default:"arcade",arcade:{debug:!1}}};function g(e){const t=`${window.location.href.split("play")[0]}play?id=${e}`,o=document.getElementById("joinLink");o instanceof HTMLAnchorElement&&(o.href=t);const s=document.getElementById("joinText");s.innerText=`Join with URL: ${t}`,o.onclick=e=>{e.preventDefault(),navigator.clipboard.writeText(t),s.innerText="Copied to Clipboard!",setTimeout((()=>{s.innerText=`Join with URL: ${t}`}),1e3)}}window.addEventListener("load",(()=>{const e=new URL(document.location.toString()).searchParams,t=e.get("id"),o=e.get("host_with");if(t)return console.log(`Joining game id: ${t}`),new i(y,void 0,t),void g(t);console.log(`Hosting game id: ${o}`),new i(v,null!=o?o:void 0),g(null!=o?o:"")}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},o={};function s(e){var i=o[e];if(void 0!==i)return i.exports;var n=o[e]={exports:{}};return t[e].call(n.exports,n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,o,i,n)=>{if(!o){var l=1/0;for(h=0;h<e.length;h++){for(var[o,i,n]=e[h],r=!0,a=0;a<o.length;a++)(!1&n||l>=n)&&Object.keys(s.O).every((e=>s.O[e](o[a])))?o.splice(a--,1):(r=!1,n<l&&(l=n));if(r){e.splice(h--,1);var d=i();void 0!==d&&(t=d)}}return t}n=n||0;for(var h=e.length;h>0&&e[h-1][2]>n;h--)e[h]=e[h-1];e[h]=[o,i,n]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={347:0};s.O.j=t=>0===e[t];var t=(t,o)=>{var i,n,[l,r,a]=o,d=0;if(l.some((t=>0!==e[t]))){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(a)var h=a(s)}for(t&&t(o);d<l.length;d++)n=l[d],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(h)},o=self.webpackChunkboxstov=self.webpackChunkboxstov||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),s.O(void 0,[216],(()=>s(608)));var i=s.O(void 0,[216],(()=>s(204)));i=s.O(i)})();