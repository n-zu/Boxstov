/*! For license information please see play.bundle.js.LICENSE.txt */
(()=>{var t,e={531:(t,e,s)=>{"use strict";s.d(e,{q:()=>O});var i=s(260);class a extends i.Game{constructor(t,e){super(t),this.gameMaster=e}}var n=i.Physics.Arcade.Sprite;const o=Math.sqrt(2)/2;var h;function r(t){switch(t){case h.Up:return[0,-1];case h.Down:return[0,1];case h.Left:return[-1,0];case h.Right:return[1,0];case h.UpLeft:return[-o,-o];case h.UpRight:return[o,-o];case h.DownLeft:return[-o,o];case h.DownRight:return[o,o]}}!function(t){t.Up="up",t.Down="down",t.Left="left",t.Right="right",t.UpLeft="upLeft",t.UpRight="upRight",t.DownLeft="downLeft",t.DownRight="downRight"}(h||(h={}));class c extends n{constructor(t,e,s,i,a,n){super(t,e,s,"player"),this.facing=h.Down,this.maxHealth=100,this.health=100,t.add.existing(this),t.physics.add.existing(this),this.id=i,this.scene=t,this.gameMaster=a,this.bulletGroup=n,this.setBodySize(180,220),this.setDisplaySize(250,250),this.setDisplayOrigin(250,320),this.setOffset(160,240),D(this,g.Player,h.Down,f.Idle)}getId(){return this.id}shoot(t=!0){{const t=new Audio("/assets/shoot.mp3");t.volume=.1,t.play()}const{x:e,y:s}=this.getGunPosition();t&&this.gameMaster.send("player",{id:this.id,payload:{type:"shoot"}}),this.bulletGroup.shootBullet(e,s,this.facing)}move(t,e=!0){const[s,i]=r(t);this.setVelocity(200*s,200*i),this.facing=t,D(this,g.Player,t,f.Run),e&&this.sendMovementMessage(t)}sync(t){if(this.syncPosition(t.position),this.syncVelocity(t.velocity),this.syncDepth(t.position.y),this.setRotation(t.rotation),this.health=t.health,t.animation)try{this.anims.currentFrame&&this.anims.play({key:t.animation.key,startFrame:t.animation.frame},!0)}catch(t){console.log(t)}}getState(){let t;return this.anims.currentAnim&&this.anims.currentFrame&&(t={key:this.anims.currentAnim.key,frame:this.anims.currentFrame.index}),this.setDepth(this.y),{id:this.id,position:{x:this.x,y:this.y},velocity:{x:this.body.velocity.x,y:this.body.velocity.y},rotation:this.rotation,animation:t,health:this.health}}stopMovement(t=!0){this.isMoving()&&t&&this.gameMaster.send("player",{id:this.id,payload:{type:"stop"}}),this.playIdleAnimation(this.facing),this.setVelocity(0,0)}handleMessage(t){switch(t.type){case"move":this.move(t.direction,!1);break;case"stop":this.stopMovement(!1);break;case"shoot":this.shoot(!1)}}syncDepth(t){Math.abs(this.y-t)>.1&&this.setDepth(t)}syncVelocity(t){(Math.abs(this.body.velocity.x-t.x)>1||Math.abs(this.body.velocity.y-t.y)>1)&&this.setVelocity(t.x,t.y)}syncPosition(t){const e=Math.abs(this.x-t.x),s=Math.abs(this.y-t.y);(e>1||s>1)&&this.setPosition(t.x,t.y)}isMoving(){return 0!==this.body.velocity.x||0!==this.body.velocity.y}playIdleAnimation(t){const e=`${g.Player}-${t}-${f.Idle}`;this.anims.play(e,!0)}sendMovementMessage(t){this.gameMaster.send("player",{id:this.id,payload:{type:"move",direction:t}})}getGunPosition(){switch(this.facing){case h.Up:return{x:this.x+15,y:this.y-120};case h.Down:return{x:this.x-16,y:this.y};case h.Left:return{x:this.x-95,y:this.y-75};case h.Right:return{x:this.x+95,y:this.y-65};case h.UpLeft:return{x:this.x-75,y:this.y-120};case h.UpRight:return{x:this.x+95,y:this.y-120};case h.DownLeft:return{x:this.x-35,y:this.y-40};case h.DownRight:return{x:this.x+45,y:this.y-10}}}}var l=Phaser.Physics.Arcade.Sprite;class y extends l{constructor(t,e,s){super(t,e,s,"bullet"),this.damage=50}fire(t,e,s){const[i,a]=this.getVelocity(s,2e3),n=Math.atan2(a,i);this.setScale(.5),this.setAlpha(.3),this.setBodySize(70,70),this.setPosition(t,e),this.setRotation(n),this.setVelocityX(i),this.setVelocityY(a),this.setActive(!0),this.setVisible(!0),this.body.enable=!0,this.scene.time.addEvent({delay:3e3,callback:()=>{this.setActive(!1),this.setVisible(!1)}})}die(){this.setActive(!1),this.setVisible(!1),this.body.enable=!1}collideWith(t){t.receiveDamage(this.damage),this.die()}getState(){return{x:this.x,y:this.y,rotation:this.rotation,active:this.active,visible:this.visible}}sync(t){this.setPosition(t.x,t.y),this.setRotation(t.rotation),this.setActive(t.active),this.setVisible(t.visible)}getVelocity(t,e){const[s,i]=r(t);return[s*e,i*e]}}class d extends Phaser.Physics.Arcade.Group{constructor(t){super(t.physics.world,t),this.createMultiple({frameQuantity:30,key:"bullet",active:!1,visible:!1,classType:y})}shootBullet(t,e,s){const i=this.getFirstDead(!1);i&&i.fire(t,e,s)}getState(){return this.children.entries.map((t=>t.getState()))}sync(t){t.forEach(((t,e)=>{const s=this.children.entries[e];s.setDepth(t.y),s.setPosition(t.x,t.y),s.setRotation(t.rotation),s.setActive(t.active),s.setVisible(t.visible)}))}}let p=0;class u{constructor(t){this.cursorKeys=t.scene.input.keyboard.createCursorKeys(),this.player=t}update(){const t=this.getAmountOfArrowsDown();if(1===t&&(this.cursorKeys.up.isDown&&this.player.move(h.Up,!0),this.cursorKeys.down.isDown&&this.player.move(h.Down,!0),this.cursorKeys.left.isDown&&this.player.move(h.Left,!0),this.cursorKeys.right.isDown&&this.player.move(h.Right,!0)),2===t&&(this.cursorKeys.up.isDown&&this.cursorKeys.left.isDown&&this.player.move(h.UpLeft,!0),this.cursorKeys.up.isDown&&this.cursorKeys.right.isDown&&this.player.move(h.UpRight,!0),this.cursorKeys.down.isDown&&this.cursorKeys.left.isDown&&this.player.move(h.DownLeft,!0),this.cursorKeys.down.isDown&&this.cursorKeys.right.isDown&&this.player.move(h.DownRight,!0)),0===t&&this.player.stopMovement(!0),this.cursorKeys.space.isDown&&Date.now()-p>100&&(p=Date.now(),this.player.shoot()),this.player.scene.input.activePointer.isDown){const t=Date.now();t-p>100&&(p=t,this.player.shoot(!0))}}getAmountOfArrowsDown(){let t=0;return this.cursorKeys.up.isDown&&t++,this.cursorKeys.down.isDown&&t++,this.cursorKeys.left.isDown&&t++,this.cursorKeys.right.isDown&&t++,t}}var m,g,f,w=Phaser.Physics.Arcade.Sprite;class b extends w{constructor(t,e,s){super(t,e,s,"zombie"),this.health=100,this.facing=h.Down,t.add.existing(this),t.physics.add.existing(this),this.scale=.75,this.setBodySize(80,180)}update(t){if(Math.random()<.95)return;if(!this.body.enable)return;const e=this.getClosesPlayer(t),s=Phaser.Math.Angle.Between(this.x,this.y,e.x,e.y),i=Phaser.Math.Distance.Between(this.x,this.y,e.x,e.y)>70?1:0;let a=Math.cos(s),n=Math.sin(s);a=Math.abs(a)<.3?0:a,n=Math.abs(n)<.3?0:n;const o=50*a,h=50*n;this.setVelocityX(o*i),this.setVelocityY(h*i);const r=this.getMovementDirection(o,h);if(r){this.facing=r;const t=0==i?f.Attack:f.Walk;D(this,g.Zombie,this.facing,t)}this.setDepth(this.y)}sync(t){this.setPosition(t.position.x,t.position.y),this.setVelocity(t.velocity.x,t.velocity.y),this.setRotation(t.rotation),this.setDepth(this.y),t.animation&&this.anims.play(t.animation.key,!0),this.setActive(t.active),this.setVisible(t.visible),this.body.enable=t.active}getState(){let t;return this.anims.currentAnim&&this.anims.currentFrame&&(t={key:this.anims.currentAnim.key,frame:this.anims.currentFrame.index}),{position:{x:this.x,y:this.y},velocity:{x:this.body.velocity.x,y:this.body.velocity.y},rotation:this.rotation,animation:t,health:this.health,active:this.active,visible:this.visible}}receiveDamage(t){this.health<=0||(this.health-=t,this.setTint(16711680),this.scene.time.delayedCall(100,(()=>{this&&this.clearTint()})),this.health<=0&&this.die())}spawn(t,e){this.setPosition(t,e),this.health=100,this.setActive(!0),this.setVisible(!0),this.body.enable=!0}getMovementDirection(t,e){return t>0&&e>0?h.DownRight:t>0&&e<0?h.UpRight:t<0&&e>0?h.DownLeft:t<0&&e<0?h.UpLeft:t>0?h.Right:t<0?h.Left:e>0?h.Down:e<0?h.Up:h.Down}getClosesPlayer(t){let e=t[0],s=null;for(const i of t){const t=Phaser.Math.Distance.Between(this.x,this.y,i.x,i.y);(null===s||t<s)&&(e=i,s=t)}return e}die(){this.setVelocity(0,0),this.setDepth(this.y-100),this.body.enable=!1,D(this,g.Zombie,this.facing,f.Die),this.setRotation(.4*Math.random()-.2),this.scene.time.delayedCall(1e4,(()=>{this.setVisible(!1),this.setActive(!1)}))}}!function(t){t.Easy="easy",t.Medium="medium",t.Hard="hard"}(m||(m={}));class v extends Phaser.Physics.Arcade.Group{constructor(t,e,s,i){super(t.physics.world,t),this.timeUntilNextHorde=0,this.createMultiple({frameQuantity:e,key:"enemy",active:!1,visible:!1,classType:b}),this.difficulty=s,this.spawnPoints=i}update(t){this.getMatching("active",!0).forEach((e=>{e.update(t)})),this.timeUntilNextHorde-=1,this.timeUntilNextHorde<=0&&(this.spawnHorde(),this.timeUntilNextHorde=1e3)}getState(){return{enemies:this.children.entries.map((t=>t.getState())),timeUntilNextHorde:this.timeUntilNextHorde,spawnPoints:this.spawnPoints}}sync(t){this.timeUntilNextHorde=t.timeUntilNextHorde,this.spawnPoints=t.spawnPoints,t.enemies.forEach(((t,e)=>{this.children.entries[e].sync(t)}))}getEnemiesToSpawn(){const t=this.getMatching("active",!1).length;switch(this.difficulty){case m.Easy:return.25*t;case m.Medium:return.5*t;case m.Hard:return.75*t}}spawnHorde(){const t=this.getEnemiesToSpawn();for(let e=0;e<t;e++){const t=this.getFirstDead(!1);if(!t)break;{const e=this.spawnPoints[Math.floor(Math.random()*this.spawnPoints.length)],s=e.x+Math.floor(100*Math.random())-50,i=e.y+Math.floor(100*Math.random())-50;t.spawn(s,i)}}}}class x{constructor(t,e){this.setupFirstPlayer(t,e),this.gameMaster=e,this.scene=t,this.setupGameMaster(e),this.enemies=new v(t,50,m.Hard,[{x:100,y:100},{x:100,y:900},{x:1800,y:100},{x:1800,y:900}]),t.physics.add.overlap(this.enemies,this.bulletGroup,((t,e)=>{const s=e,i=t;s.active&&i.active&&s.collideWith(i)})),t.physics.add.collider(this.enemies,this.enemies)}update(){this.playerControls.update(),this.enemies.update(this.players)}sync(t){t.players.forEach((t=>{this.getOrCreatePlayer(t.id).sync(t)})),this.enemies.sync(t.enemies),this.bulletGroup.sync(t.bullets)}getState(){return{players:this.players.map((t=>t.getState())),bullets:this.bulletGroup.getState(),enemies:this.enemies.getState()}}setupFirstPlayer(t,e){this.bulletGroup=new d(t);const s=Math.random().toString(36).substring(7),i=new c(t,800,500,s,e,this.bulletGroup);this.playerControls=new u(i),this.players=[i],t.cameras.main.startFollow(i),t.input.on("wheel",((e,s,i,a)=>{t.cameras.main.zoom-=.001*a}))}getOrCreatePlayer(t){let e=this.players.find((e=>e.id===t));return void 0===e&&(e=new c(this.scene,100,100,t,this.gameMaster,this.bulletGroup),this.players.push(e),this.gameMaster.send("sync",this.getState())),e}setupGameMaster(t){t.addAction("player",(t=>{this.getOrCreatePlayer(t.id).handleMessage(t.payload)})),t.addAction("sync",(t=>{this.sync(t)}))}}function D(t,e,s,i,a){t.anims.play({key:`${e}-${s}-${i}`,startFrame:a||0},!0)}!function(t){t.Player="player",t.Zombie="zombie"}(g||(g={})),function(t){t.Idle="idle",t.Run="run",t.Walk="walk",t.Attack="atk",t.Die="die"}(f||(f={}));class M extends Phaser.Scene{constructor(){super({key:"MainScene"}),this.syncCountdown=100}create(){this.createAnimations(),this.add.tileSprite(0,0,7680,4320,"tiles").setDepth(-9999),this.world=new x(this,this.game.gameMaster),this.scene.launch("UIScene",this.world.players[0]),this.gameMaster=this.game.gameMaster}getState(){return this.world.getState()}sync(t){this.world.sync(t)}update(){0==this.syncCountdown?this.gameMaster.shouldSendSync()&&(this.gameMaster.send("sync",this.world.getState()),this.syncCountdown=100):this.syncCountdown--,this.world.update()}preload(){this.load.image("tiles","assets/Floor.png"),this.load.image("bullet","assets/strip.png"),this.load.spritesheet("player","assets/Player/rifle_map.png",{frameWidth:512,frameHeight:512}),this.load.spritesheet("zombie","assets/Mobs/zombie_map_big.png",{frameWidth:512,frameHeight:512})}createAnimations(){[h.Down,h.DownRight,h.Right,h.UpRight,h.Up,h.UpLeft,h.Left,h.DownLeft].forEach(((t,e)=>{this.createAnimation(g.Player,t,f.Idle,8*e,8*e+1),this.createAnimation(g.Player,t,f.Run,8*e+2,8*e+7),this.createAnimation(g.Zombie,t,f.Walk,16*e,16*e+3,8),this.createAnimation(g.Zombie,t,f.Run,16*e+4,16*e+7,8),this.createAnimation(g.Zombie,t,f.Attack,16*e+8,16*e+11,8)})),[h.Left,h.DownLeft,h.Down,h.DownRight,h.Right,h.UpRight,h.Up,h.UpLeft].forEach(((t,e)=>{this.createAnimation(g.Zombie,t,f.Die,16*e+12,16*e+15,10)}))}createAnimation(t,e,s,i,a,n){let o=n;if(!o)switch(s){case f.Idle:o=1;break;case f.Run:case f.Attack:case f.Die:o=10}this.anims.create({key:`${t}-${e}-${s}`,frames:this.anims.generateFrameNumbers(t,{start:i,end:a}),frameRate:o,repeat:s==f.Die?0:-1})}}var P=s(983);class k{constructor(t){this.actions=[],this.peer=this.createPeer(t)}addAction(t,e){this.actions.push({type:t,action:e})}createPeer(t){return t?new P.ZP(t):new P.ZP}}class S extends k{constructor(t,e){super(),this.actions=[],this.peer=this.createPeer(e),this.hostId=t}start(){this.peer.on("open",(()=>{this.socket=this.peer.connect(this.hostId),this.socket.on("open",(()=>{console.log("Connected to host"),this.socket&&this.setupSocket(this.socket)}))}))}addAction(t,e){this.actions.push({type:t,action:e})}send(t,e){const s={type:t,payload:e};this.socket&&this.socket.send(s)}shouldSendSync(){return!1}setupSocket(t){t.on("data",(t=>{const e=t;this.actions.forEach((t=>{t.type===e.type&&t.action(e.payload)}))}))}}class A extends k{constructor(t){super(t),this.guest_sockets=[],this.peer.on("open",(t=>{O(t)}))}start(){this.peer.on("connection",(t=>{this.guest_sockets.push(t),this.setupSocket(t)}))}createPeer(t){return t?new P.ZP(t):new P.ZP}send(t,e){const s={type:t,payload:e};this.guest_sockets.forEach((t=>{t.send(s)}))}shouldSendSync(){return!0}setupSocket(t){t.on("data",(e=>{const s=e;this.actions.forEach((t=>{t.type===s.type&&t.action(s.payload)})),this.guest_sockets.forEach((e=>{t!==e&&e.send(s)}))}))}}class R{constructor(t,e,s,i){this.x=e,this.y=s,this.value=i,this.maxValue=i,this.bar=new Phaser.GameObjects.Graphics(t),this.draw(),t.add.existing(this.bar)}setHealth(t){this.value=Math.max(0,t),this.draw()}draw(){this.bar.clear(),this.bar.fillStyle(0),this.bar.fillRect(this.x,this.y,200,16),this.bar.fillStyle(16777215),this.bar.fillRect(this.x+2,this.y+2,196,12);const t=this.value/this.maxValue;t<.3?this.bar.fillStyle(16711680):this.bar.fillStyle(65280);const e=Math.max(0,200*t-4);this.bar.fillRect(this.x+2,this.y+2,e,12)}}class U extends Phaser.Scene{constructor(){super({key:"UIScene"})}create(t){this.scene.bringToTop("UIScene"),this.player=t,this.healthBar=new R(this,10,10,this.player.maxHealth)}update(){this.healthBar.setHealth(this.player.health)}}const L={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1280,height:720},scene:[M,U],antialias:!0,physics:{default:"arcade",arcade:{debug:!1}},transparent:!0};function O(t){const e=`${window.location.href.split("play")[0]}play?id=${t}`,s=document.getElementById("joinLink");s.href=e;const i=document.getElementById("joinText");i.innerText=`Join with URL: ${e}`,s.onclick=t=>{t.preventDefault(),navigator.clipboard.writeText(e),i.innerText="Copied to Clipboard!",setTimeout((()=>{i.innerText=`Join with URL: ${e}`}),1e3)}}window.addEventListener("load",(()=>{const t=new URL(document.location.toString()).searchParams,e=t.get("id"),s=t.get("host_with");if(e){console.log(`Joining game id: ${e}`);const t=new S(e);return t.start(),new a(L,t),void O(e)}let i;console.log(`Hosting game id: ${s}`),i=s?new A(s):new A,i.start(),new a(L,i),O(null!=s?s:"")}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(t){var a=s[t];if(void 0!==a)return a.exports;var n=s[t]={exports:{}};return e[t].call(n.exports,n,n.exports,i),n.exports}i.m=e,t=[],i.O=(e,s,a,n)=>{if(!s){var o=1/0;for(l=0;l<t.length;l++){for(var[s,a,n]=t[l],h=!0,r=0;r<s.length;r++)(!1&n||o>=n)&&Object.keys(i.O).every((t=>i.O[t](s[r])))?s.splice(r--,1):(h=!1,n<o&&(o=n));if(h){t.splice(l--,1);var c=a();void 0!==c&&(e=c)}}return e}n=n||0;for(var l=t.length;l>0&&t[l-1][2]>n;l--)t[l]=t[l-1];t[l]=[s,a,n]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={347:0};i.O.j=e=>0===t[e];var e=(e,s)=>{var a,n,[o,h,r]=s,c=0;if(o.some((e=>0!==t[e]))){for(a in h)i.o(h,a)&&(i.m[a]=h[a]);if(r)var l=r(i)}for(e&&e(s);c<o.length;c++)n=o[c],i.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return i.O(l)},s=self.webpackChunkboxstov=self.webpackChunkboxstov||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(531)));var a=i.O(void 0,[216],(()=>i(204)));a=i.O(a)})();