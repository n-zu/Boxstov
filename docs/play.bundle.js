/*! For license information please see play.bundle.js.LICENSE.txt */
(()=>{var e,t={608:(e,t,s)=>{"use strict";var o=s(260);class i extends o.Game{constructor(e,t,s,o){console.log("Creating game"),console.log("Player id: "+t),console.log("Socket id: "+s),console.log("Id to connect: "+o),super(e),this.playerId=t,this.socketId=s,this.idToConnect=o}}var n=Phaser.Physics.Arcade.Sprite;class a extends n{constructor(e,t,s,o){super(e,t,s,"player"),e.add.existing(this),e.physics.add.existing(this),this.id=o,this.gameMaster=e.gameMaster}sync(e){this.setPosition(e.position.x,e.position.y),this.setVelocity(e.velocity.x,e.velocity.y),this.setRotation(e.rotation)}update(e){this.updateLeft(e),this.updateRight(e),this.updateUp(e),this.updateDown(e),this.updateStop(e)}moveUp(){this.setVelocityY(-30)}moveDown(){this.setVelocityY(30)}moveLeft(){this.setVelocityX(-30)}moveRight(){this.setVelocityX(30)}getState(){return{id:this.id,position:{x:this.x,y:this.y},velocity:{x:this.body.velocity.x,y:this.body.velocity.y},rotation:this.rotation}}updateStop(e){e.up.isDown||e.down.isDown||e.left.isDown||e.right.isDown||0===this.body.velocity.x&&0===this.body.velocity.y||(this.gameMaster.stop(this.id),this.stopMovement())}updateUp(e){e.up.isDown&&(this.gameMaster.move(this.id,"up"),this.moveUp())}updateDown(e){e.down.isDown&&(this.gameMaster.move(this.id,"down"),this.moveDown())}updateLeft(e){e.left.isDown&&(this.gameMaster.move(this.id,"left"),this.moveLeft())}updateRight(e){e.right.isDown&&(this.gameMaster.move(this.id,"right"),this.moveRight())}shootInWorld(e,t,s){const o=Phaser.Math.Angle.Between(this.x,this.y,e,t);this.gameMaster.shoot(this.id,e,t),s.spawnBullet(this.x,this.y,o)}stopMovement(){this.setVelocity(0,0)}}var r=Phaser.Physics.Arcade.Sprite;class l extends r{fire(e,t,s){console.log(e,t,s),this.setActive(!0),this.setVisible(!0),this.setPosition(e,t),this.setRotation(s),this.setVelocityX(200*Math.cos(s)),this.setVelocityY(200*Math.sin(s)),this.scene.time.addEvent({delay:1e3,callback:()=>{this.setActive(!1),this.setVisible(!1)}})}}class h extends Phaser.Physics.Arcade.Group{constructor(e){super(e.physics.world,e),this.createMultiple({frameQuantity:30,key:"bullet",active:!1,visible:!1,classType:l})}shootBullet(e,t,s){const o=this.getFirstDead(!1);o&&o.fire(e,t,s)}getState(){return{}}}class c{constructor(e,t){this.players=e,this.bulletsGroup=new h(t)}updatePlayerPosition(e,t){this.players[e].update(t)}update(){}sync(e){this.players.forEach((t=>{const s=e.players.find((e=>e.id===t.id));s&&t.sync(s)}))}getState(){return{players:this.players.map((e=>e.getState())),bullets:this.bulletsGroup.getState()}}stop(e){this.players[e].stopMovement()}shoot(e,t,s){this.players[e].shootInWorld(t,s,this)}spawnBullet(e,t,s){this.bulletsGroup.shootBullet(e,t,s)}movePlayerUp(e){this.players[e].moveUp()}movePlayerDown(e){this.players[e].moveDown()}movePlayerLeft(e){this.players[e].moveLeft()}movePlayerRight(e){this.players[e].moveRight()}}var d=s(983);class p{constructor(e,t,s){this.scene=e,this.peer=this.createPeer(t),s?this.connectTo(s):this.waitForConnection(),void 0===s&&setInterval((()=>{var e;null===(e=this.socket)||void 0===e||e.send({type:"sync",time:Date.now(),state:this.scene.getState()})}),500)}createPeer(e){return e?new d.ZP(e):new d.ZP}connectTo(e){this.peer.on("open",(()=>{var t;console.log("Connecting to id: "+e),this.socket=this.peer.connect(e),null===(t=this.socket)||void 0===t||t.on("open",(()=>{var t;console.log("Connection established with id: "+e),null===(t=this.socket)||void 0===t||t.send("Hello from "+this.peer.id),console.log("Socket? "+this.socket),this.socket&&this.socket.on("data",(e=>{console.log("Data received"),console.log(e),this.handleMessage(e)}))}))}))}handleMessage(e){if("move"==e.type)switch(console.log("Move message received"),e.direction){case"up":this.scene.movePlayerUp(e.playerId);break;case"down":this.scene.movePlayerDown(e.playerId);break;case"left":this.scene.movePlayerLeft(e.playerId);break;case"right":this.scene.movePlayerRight(e.playerId)}else"shoot"==e.type?(console.log("Shoot message received"),this.scene.shoot(e.playerId,e.x,e.y)):"stop"==e.type?(console.log("Stop message received"),this.scene.stop(e.playerId)):"sync"==e.type&&(console.log("Sync message received"),this.scene.sync(e.state))}waitForConnection(){console.log("Waiting for connection (HostId: "+this.peer.id+")"),this.peer.on("connection",(e=>{var t;console.log("Opened connection with id: "+e.peer),this.socket=e,null===(t=this.socket)||void 0===t||t.on("open",(()=>{var e;null===(e=this.socket)||void 0===e||e.on("data",(e=>{console.log("Data received"),console.log(e),this.handleMessage(e)}))}))}))}move(e,t){var s;null===(s=this.socket)||void 0===s||s.send({type:"move",playerId:e,direction:t})}shoot(e,t,s){var o;console.log("Sending shoot message"),null===(o=this.socket)||void 0===o||o.send({type:"shoot",playerId:e,x:t,y:s})}stop(e){var t;null===(t=this.socket)||void 0===t||t.send({type:"stop",playerId:e})}}class y extends Phaser.Scene{constructor(){super({key:"MainScene"})}shoot(e,t,s){const o=Phaser.Math.Angle.Between(this.world.players[e].x,this.world.players[e].y,t,s);this.world.spawnBullet(this.world.players[e].x,this.world.players[e].y,o)}stop(e){this.world.stop(e)}create(){this.gameMaster=new p(this,this.game.socketId,this.game.idToConnect);const e=new a(this,100,100,this.game.playerId),t=new a(this,100,100,this.game.playerId);this.world=new c([e,t],this),this.controlKeys=this.input.keyboard.createCursorKeys(),this.input.on("pointerdown",(e=>{this.world.shoot(this.game.playerId,e.x,e.y)}))}getState(){return this.world.getState()}sync(e){this.world.sync(e)}update(){this.world.update(),this.world.updatePlayerPosition(this.game.playerId,this.controlKeys)}preload(){this.load.image("player","assets/bunny.png"),this.load.image("bullet","assets/bullet.png")}movePlayerUp(e){this.world.movePlayerUp(e)}movePlayerDown(e){this.world.movePlayerDown(e)}movePlayerLeft(e){this.world.movePlayerLeft(e)}movePlayerRight(e){this.world.movePlayerRight(e)}}const g={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:300,height:200},scene:[y],physics:{default:"arcade",arcade:{debug:!1}}},u={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:300,height:200},scene:[y],physics:{default:"arcade",arcade:{debug:!1}}};function v(e){const t=`http://localhost:8080/play?id=${e}`,s=document.getElementById("joinLink");s instanceof HTMLAnchorElement&&(s.href=t);const o=document.getElementById("joinText");o instanceof HTMLHeadingElement&&(o.innerText=`Join with URL: ${t}`)}window.addEventListener("load",(()=>{const e=new URL(document.location.toString()).searchParams,t=e.get("id"),s=e.get("host_with");if(t)return console.log(`Joining game id: ${t}`),new i(u,1,void 0,t),void v(t);console.log(`Hosting game id: ${s}`),new i(g,0,null!=s?s:void 0),v(null!=s?s:"")}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function o(e){var i=s[e];if(void 0!==i)return i.exports;var n=s[e]={exports:{}};return t[e].call(n.exports,n,n.exports,o),n.exports}o.m=t,e=[],o.O=(t,s,i,n)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,i,n]=e[c],r=!0,l=0;l<s.length;l++)(!1&n||a>=n)&&Object.keys(o.O).every((e=>o.O[e](s[l])))?s.splice(l--,1):(r=!1,n<a&&(a=n));if(r){e.splice(c--,1);var h=i();void 0!==h&&(t=h)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,i,n]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={347:0};o.O.j=t=>0===e[t];var t=(t,s)=>{var i,n,[a,r,l]=s,h=0;if(a.some((t=>0!==e[t]))){for(i in r)o.o(r,i)&&(o.m[i]=r[i]);if(l)var c=l(o)}for(t&&t(s);h<a.length;h++)n=a[h],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(c)},s=self.webpackChunkboxstov=self.webpackChunkboxstov||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),o.O(void 0,[216],(()=>o(608)));var i=o.O(void 0,[216],(()=>o(204)));i=o.O(i)})();